# 📈 A股智能分析与预测系统 (AI Stock Analysis System)

基于 Transformer 架构的深度学习量化分析系统，具备双核模型（稳健/激进）、全市场扫描、持仓诊断及自我进化（错题本）能力。

## ✨ 核心特性

*   **🧠 双核模型引擎**:
    *   **🛡️ 稳健模型 (Conservative)**: 专注沪深300+中证500核心资产，追求高胜率与低回撤，适合大资金配置。
    *   **🔥 激进模型 (Aggressive)**: 覆盖全市场股票（含题材/小票），捕捉高波动与妖股机会，适合博弈。
*   **📊 高阶特征工程**:
    *   集成 **ATR** (波动率)、**Ichimoku** (支撑阻力)、**RSI**、**MACD**、**KDJ**、**Bollinger Bands**、**OBV** 等 **20维** 深度特征。
    *   采用 **Log Price (对数价格)** 标准化处理，有效解决股价非平稳性问题，显著提升模型泛化能力。
*   **🔄 自我进化机制**:
    *   独创 **Feedback Loop (错题本)** 系统，自动记录预测偏差大的案例，通过高权重微调（Fine-tuning）让模型“吃一堑长一智”。
*   **🔭 智能扫描与诊断**:
    *   **全市场深度扫描**：自动挖掘潜力股，生成潜力榜单 Top 10 及详细 CSV 报表。
    *   **持仓智能分析**：结合 AI 预测涨幅与 RSI 技术指标，给出具体的 **操作建议**（🚀 强力买入 / 🛑 止损 / 🟢 持有）。

## 📂 项目结构

```
.
├── train.py           # 🚀 训练主程序 (支持全量/增量/双核模式)
├── scan.py            # 🤖 扫描与预测主程序 (持仓分析/全市场扫描)
├── feedback_loop.py   # 📝 错题本与验证系统 (闭环优化)
├── stock_common.py    # ⚙️ 核心配置、数据获取与特征工程
├── requirements.txt   # 📦 项目依赖库
└── README.md          # 📖 项目说明文档
```

## 🚀 快速开始

### 1. 环境准备

确保 Python 版本 >= 3.8，安装依赖：

```bash
pip install -r requirements.txt
```

### 2. 模型训练 (初始化)

首次使用或大幅更新代码后，需要训练模型。建议分别训练两个核心：

```bash
python train.py
```
*   **步骤 1**: 选择 `1` (稳健模型) -> 选择 `1` (全量训练)
*   **步骤 2**: 再次运行 `python train.py` -> 选择 `2` (激进模型) -> 选择 `1` (全量训练)

> **提示**: 日常使用可选择 `2` (增量精调) 进行快速更新。

### 3. 市场扫描 / 持仓分析

```bash
python scan.py
```
*   **功能 1: 持仓智能分析**
    *   需先在 `stock_common.py` 的 `Config.MY_PORTFOLIO` 中配置您的持仓成本。
    *   系统将输出每只持仓股的 AI 建议。
*   **功能 2: 市场扫描**
    *   选择扫描模式 (稳健/激进)。
    *   系统将扫描对应股票池，并生成 `scan_result_*.csv` 文件。

### 4. 盘后验证 (错题本)

收盘后运行，验证预测准确度并更新错题本：

```bash
python feedback_loop.py
```
*   **功能 1: 盘前记录**: 将最新的扫描结果导入待验证列表。
*   **功能 2: 盘后验证**: 自动对比预测值与真实收盘价，记录误差。

## ⚙️ 配置说明

打开 `stock_common.py` 可自定义以下参数：

*   `MY_PORTFOLIO`: **[重要]** 您的持仓配置，格式：`'代码': {'qty': 数量, 'cost': 成本价}`。
*   `LOOKBACK`: 模型回看历史天数 (默认 60)。
*   `EPOCHS`: 训练轮数 (默认 40)。
*   `INPUT_DIM`: 特征维度 (自动计算，当前为 20)。


## 🧠 双核模型详解 (Dual-Core Architecture)

本项目采用独特的“双核”设计，旨在应对不同市场环境与投资风格。两个模型独立训练、独立进化，互不干扰。

### 1. 🛡️ 稳健模型 (Conservative Model)
*   **代号**: `model_conservative.pth`
*   **股票池**: **沪深300 + 中证500** (约 800 只核心资产)
*   **设计理念**: 
    *   专注“白马股”与“行业龙头”，避开流动性差、易被操纵的小票。
    *   训练数据更加平滑、规律，模型更容易学到宏观趋势与价值回归逻辑。
*   **适用场景**: 
    *   大资金配置、长期持仓。
    *   追求 β (市场平均收益) + 低 α (超额收益)。
    *   风险厌恶型投资者。
*   **预期表现**: 预测准确率较高，回撤较小，但很难捕捉到短期暴涨的“妖股”。

### 2. 🔥 激进模型 (Aggressive Model)
*   **代号**: `model_aggressive.pth`
*   **股票池**: **全市场 A 股** (约 5000+ 只，含创业板、科创板、ST等)
*   **设计理念**: 
    *   不设门槛，通过海量数据让模型学习各种极端的市场形态（如连板、天地板）。
    *   利用 Transformer 强大的序列建模能力，试图捕捉短期情绪波动与资金博弈痕迹。
*   **适用场景**: 
    *   小资金博弈、短线交易。
    *   追求高 α (超额收益)，能承受高波动。
    *   风险偏好型投资者。
*   **预期表现**: 可能会挖掘出涨停潜力股，但误报率（False Positive）也相对较高，需要配合严格的止损策略（如 `StockScanner` 中的 RSI 过滤）。

